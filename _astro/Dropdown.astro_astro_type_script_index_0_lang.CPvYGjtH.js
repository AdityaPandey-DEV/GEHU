class a{dropdown;trigger;content;items=[];currentFocusIndex=-1;isOpen=!1;isClosing=!1;animationDuration=150;openOnHover;closeDelay;closeTimerRef=null;lastOpenSource="keyboard";lastCloseSource="keyboard";constructor(t,e){this.dropdown=t,this.openOnHover=t.getAttribute("data-open-on-hover")==="true",this.closeDelay=parseInt(t.getAttribute("data-close-delay")||"200");const i=t.querySelector(".starwind-dropdown-trigger");if(i?.hasAttribute("data-as-child")?this.trigger=i.firstElementChild:this.trigger=i,this.content=t.querySelector(".starwind-dropdown-content"),!this.trigger||!this.content)return;const n=this.content.style.animationDuration;n.endsWith("ms")?this.animationDuration=parseFloat(n):n.endsWith("s")&&(this.animationDuration=parseFloat(n)*1e3),this.init(e)}init(t){this.setupAccessibility(t),this.setupEvents()}setupAccessibility(t){!this.trigger||!this.content||(this.trigger.id=`starwind-dropdown${t}-trigger`,this.content.id=`starwind-dropdown${t}-content`,this.trigger.setAttribute("aria-controls",this.content.id),this.content.setAttribute("aria-labelledby",this.trigger.id))}setupEvents(){!this.trigger||!this.content||(this.trigger.addEventListener("click",t=>{t.preventDefault(),this.lastOpenSource=t.detail===0?"keyboard":"mouse",this.toggleDropdown()}),this.trigger.addEventListener("keydown",t=>{t.key==="Enter"||t.key===" "?(t.preventDefault(),this.lastOpenSource="keyboard",this.toggleDropdown()):t.key==="Escape"&&this.isOpen?(t.preventDefault(),this.lastCloseSource="keyboard",this.closeDropdown()):this.isOpen&&(t.key==="ArrowDown"||t.key==="ArrowUp")&&(t.preventDefault(),this.lastOpenSource="keyboard",this.updateDropdownItems(),t.key==="ArrowDown"?this.focusItem(0):this.focusItem(this.items.length-1))}),document.addEventListener("pointerdown",t=>{this.isOpen&&!this.dropdown.contains(t.target)&&t.button===0&&t.ctrlKey===!1&&t.pointerType==="mouse"&&this.closeDropdown()}),document.addEventListener("click",t=>{!(this.trigger?.contains(t.target)||this.content?.contains(t.target))&&this.isOpen&&this.closeDropdown()}),this.content.addEventListener("keydown",t=>{t.key==="Escape"?(t.preventDefault(),this.closeDropdown(),this.trigger?.focus()):this.isOpen&&this.handleMenuKeydown(t)}),this.content.addEventListener("click",t=>{const i=t.target.closest('[role="menuitem"]');i&&!i.hasAttribute("data-disabled")&&(this.closeDropdown(),console.log("click closing"))}),this.content.addEventListener("mouseover",t=>{const i=t.target.closest('[role="menuitem"]');i&&i instanceof HTMLElement&&this.isOpen===!0&&(this.updateDropdownItems(),i.focus(),this.currentFocusIndex=this.items.indexOf(i))}),this.openOnHover&&(this.trigger.addEventListener("pointerenter",t=>{t.pointerType==="mouse"&&(this.isClosing||(this.isOpen?this.clearCloseTimer():(this.lastOpenSource="mouse",this.openDropdown())))}),this.dropdown.addEventListener("pointerleave",t=>{t.pointerType==="mouse"&&this.isOpen&&(this.lastCloseSource="mouse",this.closeDropdownDelayed())}),this.content.addEventListener("pointerenter",t=>{t.pointerType==="mouse"&&this.clearCloseTimer()})))}handleMenuKeydown(t){if(this.updateDropdownItems(),this.items.length===0)return;const e=this.currentFocusIndex;switch(t.key){case"ArrowDown":t.preventDefault(),this.focusItem(e===-1?0:e+1);break;case"ArrowUp":t.preventDefault(),this.focusItem(e===-1?this.items.length-1:e-1);break;case"Home":t.preventDefault(),this.focusItem(0);break;case"End":t.preventDefault(),this.focusItem(this.items.length-1);break;case"Enter":case" ":e!==-1&&(t.preventDefault(),this.items[e].click());break}}updateDropdownItems(){this.content&&(this.items=Array.from(this.content.querySelectorAll('[role="menuitem"]:not([data-disabled="true"])')))}focusItem(t){const e=(t+this.items.length)%this.items.length;this.items[e]&&(this.items[e].focus(),this.currentFocusIndex=e)}toggleDropdown(){this.isOpen?this.closeDropdown():this.openDropdown()}openDropdown(){this.isClosing||!this.content||!this.trigger||this.trigger.disabled||(this.isOpen=!0,this.content.setAttribute("data-state","open"),this.trigger.setAttribute("aria-expanded","true"),this.content.style.removeProperty("display"),this.updateDropdownItems(),this.currentFocusIndex=-1,this.positionContent())}closeDropdown(){!this.content||!this.trigger||(this.isClosing=!0,this.isOpen=!1,this.content.setAttribute("data-state","closed"),(!this.openOnHover||this.lastOpenSource==="keyboard"||this.lastCloseSource==="keyboard")&&requestAnimationFrame(()=>{this.trigger&&this.trigger.focus()}),setTimeout(()=>{this.content&&(this.content.style.display="none",this.isClosing=!1)},this.animationDuration),this.trigger.setAttribute("aria-expanded","false"),this.currentFocusIndex=-1)}closeDropdownDelayed(){!this.content||!this.trigger||(this.clearCloseTimer(),this.closeTimerRef=window.setTimeout(()=>{this.isOpen&&this.closeDropdown(),this.closeTimerRef=null},this.closeDelay))}clearCloseTimer(){this.closeTimerRef!==null&&(window.clearTimeout(this.closeTimerRef),this.closeTimerRef=null)}positionContent(){!this.content||!this.trigger||(this.content.style.width="var(--starwind-dropdown-trigger-width)",this.content.style.setProperty("--starwind-dropdown-trigger-width",`${this.trigger.offsetWidth}px`))}}const r=new WeakMap,o=()=>{document.querySelectorAll(".starwind-dropdown").forEach((s,t)=>{s instanceof HTMLElement&&!r.has(s)&&r.set(s,new a(s,t))})};o();document.addEventListener("astro:after-swap",o);
